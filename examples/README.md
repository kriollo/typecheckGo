# TypeScript Type Checker - Code Input Examples

This directory contains examples showing how to use the TypeScript type checker with code passed as text input instead of files.

## Overview

The `--code` flag allows you to pass TypeScript code directly as a string, making it easy to integrate the type checker into compilers, build tools, IDEs, or any other system that generates or manipulates TypeScript code.

## Quick Examples

### 1. Basic Usage

```bash
# Check a simple TypeScript expression
./tscheck check --code "const x: number = 5;" --filename "example.ts"

# Check code with an error
./tscheck check --code "const x: number = 'string';" --filename "error.ts"
```

### 2. Multi-line Code

```bash
# Use heredoc for multi-line code
./tscheck check --code "
interface User {
    name: string;
    age: number;
}

const user: User = {
    name: 'Alice',
    age: 30
};
" --filename "user.ts"
```

### 3. Different Output Formats

```bash
# Text format (default) - human-readable with colors
./tscheck check --code "let x = unknownVar;" -f text

# JSON format - for programmatic parsing
./tscheck check --code "let x = unknownVar;" -f json

# TOON format - custom structured format
./tscheck check --code "let x = unknownVar;" -f toon
```

### 4. Get AST

```bash
# View the Abstract Syntax Tree
./tscheck check --code "const x: number = 42;" --ast
```

## Command Line Flags

| Flag | Short | Description | Default |
|------|-------|-------------|---------|
| `--code` | `-c` | TypeScript code as text input | (required if no path) |
| `--filename` | `-n` | Filename to use for error reporting | `"stdin.ts"` |
| `--format` | `-f` | Output format: `text`, `json`, `toon` | `"text"` |
| `--ast` | `-a` | Show Abstract Syntax Tree | `false` |

## Integration Examples

### From Go

See `code_input_example.go` for a complete Go integration example:

```go
package main

import (
    "fmt"
    "os/exec"
)

func CheckTypeScript(code string) error {
    cmd := exec.Command("tscheck", "check", "--code", code, "--filename", "generated.ts")
    output, err := cmd.CombinedOutput()
    if err != nil {
        return fmt.Errorf("type check failed: %s", output)
    }
    fmt.Println(string(output))
    return nil
}

func main() {
    code := `const x: number = 5; const y: string = x;`
    if err := CheckTypeScript(code); err != nil {
        fmt.Println("Error:", err)
    }
}
```

Run the example:
```bash
cd examples
go run code_input_example.go
```

### From Shell Script

See `check_code.sh` for a complete shell script example:

```bash
#!/bin/bash

# Check TypeScript code from variable
TS_CODE='
type User = {
    name: string;
    age: number;
};

const user: User = {
    name: "John",
    age: 30
};
'

./tscheck check --code "$TS_CODE" --filename "user.ts"
```

Run the example:
```bash
cd examples
chmod +x check_code.sh
./check_code.sh
```

### From Python

```python
import subprocess
import json

def check_typescript(code, filename="script.ts"):
    result = subprocess.run(
        ["tscheck", "check", "--code", code, "--filename", filename, "--format", "json"],
        capture_output=True,
        text=True
    )
    
    if result.returncode != 0:
        errors = json.loads(result.stdout)
        return {"success": False, "errors": errors}
    
    return {"success": True, "errors": []}

# Example usage
code = """
const x: number = 5;
const y: string = x;  // Error
"""

result = check_typescript(code)
if not result["success"]:
    print("Type errors found:")
    for error in result["errors"]:
        print(f"  Line {error['line']}: {error['message']}")
```

### From Node.js

```javascript
const { execSync } = require('child_process');

function checkTypeScript(code, filename = 'script.ts') {
    try {
        const output = execSync(
            `tscheck check --code "${code.replace(/"/g, '\\"')}" --filename "${filename}"`,
            { encoding: 'utf-8' }
        );
        return { success: true, output };
    } catch (error) {
        return { success: false, output: error.stdout };
    }
}

// Example usage
const code = `
const x: number = 5;
const y: string = x;  // Error
`;

const result = checkTypeScript(code);
console.log(result.output);
```

## Use Cases

### 1. Compiler Integration

Validate TypeScript code generated by your compiler:

```bash
# After generating TypeScript code
GENERATED_CODE=$(your_compiler generate)
./tscheck check --code "$GENERATED_CODE" --filename "compiled.ts"
```

### 2. IDE/Editor Integration

Check code as the user types:

```bash
# Check current buffer content
BUFFER_CONTENT=$(get_buffer_content)
./tscheck check --code "$BUFFER_CONTENT" --filename "$CURRENT_FILE" --format json
```

### 3. Build Tool Integration

Validate TypeScript snippets in documentation or tests:

```bash
# Extract and validate TypeScript from markdown
EXTRACTED_CODE=$(extract_typescript_from_markdown README.md)
./tscheck check --code "$EXTRACTED_CODE" --filename "docs.ts"
```

### 4. CI/CD Pipeline

```bash
# In your CI script
for snippet in $(extract_code_snippets); do
    ./tscheck check --code "$snippet" --filename "snippet_${i}.ts" || exit 1
    ((i++))
done
```

### 5. Template Validation

Validate TypeScript templates before rendering:

```bash
TEMPLATE='
interface {{.InterfaceName}} {
    {{range .Fields}}
    {{.Name}}: {{.Type}};
    {{end}}
}
'

RENDERED=$(render_template "$TEMPLATE")
./tscheck check --code "$RENDERED" --filename "template.ts"
```

## Output Formats

### Text Format (Default)

Human-readable output with colors and context:

```
  × Cannot find name 'unknownVar'.
  Sugerencia: Verifica que la variable esté declarada antes de usarla
   ╭─[test.ts:1:9]
   1 │ let x = unknownVar;
             ^ [TS2304]
   ╰────

Found 1 error(s).
```

### JSON Format

Machine-readable output for programmatic parsing:

```json
[
  {
    "file": "test.ts",
    "line": 1,
    "column": 9,
    "message": "Cannot find name 'unknownVar'.",
    "code": "TS2304",
    "severity": "error"
  }
]
```

### TOON Format

Custom structured format:

```
errors[1]{file,line,column,message,code,severity}:
  test.ts,1,9,"Cannot find name 'unknownVar'.",TS2304,error
```

## Advanced Examples

### Type Inference with `infer` Keyword

```bash
./tscheck check --code "
type ArrayElement<T> = T extends (infer U)[] ? U : never;
type ReturnType<T> = T extends (...args: any[]) => infer R ? R : any;

type StringArray = string[];
type Element = ArrayElement<StringArray>;
" --filename "advanced.ts"
```

### Generic Types

```bash
./tscheck check --code "
function identity<T>(arg: T): T {
    return arg;
}

const num = identity<number>(42);
const str = identity<string>('hello');
" --filename "generics.ts"
```

### Union and Intersection Types

```bash
./tscheck check --code "
type A = { a: string };
type B = { b: number };
type C = A & B;
type D = A | B;

const obj: C = { a: 'test', b: 42 };
" --filename "types.ts"
```

## Troubleshooting

### Issue: Command not found

Make sure `tscheck` is in your PATH or use the full path:

```bash
# Build first
cd /path/to/typecheker
go build -o tscheck

# Use full path
/path/to/tscheck check --code "const x = 5;"
```

### Issue: Special characters in code

Use proper escaping or heredoc for complex code:

```bash
# Using heredoc
./tscheck check --code "$(cat <<'EOF'
const str: string = "Hello \"World\"";
const template = `Template ${str}`;
EOF
)" --filename "complex.ts"
```

### Issue: Line endings

The checker handles both Unix (`\n`) and Windows (`\r\n`) line endings automatically.

## Notes

- The `--filename` parameter only affects error reporting; it doesn't read from an actual file
- The checker respects `tsconfig.json` in the current working directory
- Default filename is `"stdin.ts"` when not specified
- All normal type checking rules and configurations apply

## More Information

- See main README.md for full feature list
- Check `code_input_example.go` for Go integration
- Check `check_code.sh` for shell script examples
- Visit the project repository for more documentation